---
title: "Math Performance in Relation to School and Social Factors"
author: "Isabel Gomez, Dhajanae Sylvertooth, Nicholas Hartman, Ritoban Kundu"
date: ""
bibliography: bib.bib
output: pdf_document
---

\section{Introduction}

Academic proficiency during the formative years of schooling has widespread implications on future development [@first]. It has been shown that education outcomes are linked to a complex set of biological, social, and policy factors. In this report, we focus on math performance in elementary school students over time, and study the relationships between math proficiency and several social and school characteristics. Using the Gini Index, nonparametric estimation, and longitudinal modeling techniques, we explore several different aspects of math proficiency, such as inequality and progress over time. 

The data for this analysis comes from the Early Childhood Longitudinal Study (ECLS), which was a prospective cohort study of elementary school students from 2011-2016. Students were followed from kindergarten to fifth grade, and math performance was assessed each year. In addition, detailed surveys were conducted over time to collect data on a wide range of social factors. The public-use dataset contains information from 970 schools and 18,174 individual students. The dataset contains over 26,000 variables and is 1.67 GB in size, which introduced substantial computational challenges in our analyses.  

\section{Descriptive Plots}

```{r, echo=FALSE,warnings=F,message=F}
library(ggplot2)
```

\section{Math Score Inequality}

\noindent We studied the amount of inequality in math performance and how this changes over time within public and private elementary schools. To accomplish this, we used the Gini Index, which is a well-known measure of inequality and is commonly used to describe wealth inequality. The formula for the Gini Index is

$$\textrm{Gini}=\frac{\sum_{i=1}^n \sum_{j=1}^n |x_i-x_j|}{2n^2\bar{x}},$$
\noindent where $x$ represents the math score. Higher Gini Index values correspond to more inequality in the math scores. For this analysis, we used a re-scaled version of the math scores since $x$ must be positive in the Gini index formula. There are two main computational challenges that arise in Gini index estimation:

\begin{enumerate}
\item Due to a lack of theoretical formulas for the Gini Index standard error, nonparametric bootstrapping is needed to estimate the uncertainty in the Gini Index. 
\item The Gini index involves many pairwise comparisons for large datasets.
\end{enumerate}

We addressed the challenges of (2) by using a vectorized implementation of the Gini Index from the reldist package in R [@reldist]. Then, to further speed up the resampling in (1), we used parallel computing. For each type of school (Public vs. Private) and for each timepoint, we resampled the corresponding data with replacement 10,000 times and computed the Gini Index on each of these bootstrap samples. A 95\% confidence interval for each point estimate was computed from the quantiles of the bootstrap distribution. The figure below shows the Gini Index estimates and bootstrap 95\% confidence intervals over time, stratified by school type:

```{r, echo=FALSE,fig.width=12}
setwd("//Users//nicholashartman//Downloads//Education Data")

#Read from cluster-generated files
ests=as.matrix(read.csv("ests.csv")[,-1])
boots=as.matrix(read.csv("boots.csv")[,-1])
lower=as.matrix(read.csv("lower.csv")[,-1])
upper=as.matrix(read.csv("upper.csv")[,-1])
ggdata=data.frame(ests=c(ests[1,],ests[2,]),lower=c(lower[1,],lower[2,]),time=c(1:6,1:6),
                  upper=c(upper[1,],upper[2,]),school=c(rep("Public",6),rep("Private",6)))
g=ggplot(ggdata,aes(x=time,y=ests,group=school,color=school))+geom_line()+geom_point()
g=g+geom_errorbar(aes(ymin=lower, ymax=upper))+theme_classic()
g=g+ylab("Gini Index")+xlab("Cohort Assessment")
g=g+scale_x_continuous(breaks=1:6,labels=c("Spring 2011","Spring 2012","Spring 2013",
                                            "Spring 2014","Spring 2015","Spring 2016"))
g=g+theme(text=element_text(size=15))+labs(color="School Type")
g
```

\noindent We find that the Gini Index decreases over time within both public and private schools. One interpretation of this result is that the kindergarten students with lower scores were able to catch up to the high performers by fifth grade. We also observed that there is more inequality in math scores within public schools compared to within private schools. The magnitude of this difference remained fairly constant over time, and since the 95\% confidence intervals do not overlap, we can conclude that these differences are statistically significant. 

\section{Longitudinal Models}

To study the relationships between social factors and math performance over time, we used a Generalized Least Squares (GLS) approach. We chose to use GLS over mixed models because we are mainly interested in the marginal associations. No structure was assumed for the covariance matrix of scores over time because it resulted in a substantially better model fit compared to other covariance structures (such as AR1). We specified the marginal model as:

\begin{align*}E[\textrm{Score}_{ij}]&=\beta_0+\beta_1\textrm{Time}_{ij}+\beta_2 I(\textrm{School}_i=\textrm{Private})+\beta_3 \textrm{Teacher\_Education}_i+\beta_4 \textrm{Parent\_Education}_i\\
 &+\beta_5 \textrm{Locale} + \beta_6 I(\textrm{School}_i=\textrm{Private}) \times \textrm{Time}_{ij}+\beta_7 \textrm{Teacher\_Education}_i \times \textrm{Time}_{ij} \\
 &+\beta_8 \textrm{Parent\_Education}_i \times \textrm{Time}_{ij}+\beta_9 \textrm{Locale}_i \times \textrm{Time}_{ij}
 \end{align*}

Given that the data contained a substantial amount of missing data, we performed multiple imputation using chained equations using the mice package in R [@mi]. The data were imputed using the predictions from linear, logistic, proportional odds, and multinomial models for continuous, binary, ordinal, and categorical data respectively. One hundred imputated datasets were created and the GLS model was fit to each one simultaneously using cluster computing. This reduced the computational time from approximately 8 hours to 5 minutes. The estimates were then combined according to Rubin's multiple imputation rules. Any model that did not converge was discarded from the analysis. A forest plot of the point estimates and 95\% confidence intervals is shown:

```{r, echo=FALSE}
#Run on local computer to make plot
setwd("//Users//nicholashartman//Downloads")
GLS=read.csv("GLS.csv")[,-1]
GLS_SE=read.csv("GLS_SE.csv")[,-1]
low=GLS-1.96*GLS_SE
up=GLS+1.96*GLS_SE
label=c("Intercept","Teacher Education","Time","Parent Education","Suburb","Town","Rural",
            "Private School","Teacher Education x Time","Parent Education x Time","Suburb x Time",
            "Town x Time","Rural x Time","Private School x Time")
GLS_data=data.frame(GLS,low,up,label)
GLS_data=GLS_data[14:2,]
GLS_data=GLS_data[c(1:11,13,12),]
GLS_data$label_num=c(1:13)
g=ggplot(GLS_data)+geom_point(aes(x=label_num,y=GLS))+coord_flip()
g=g+geom_hline(yintercept=0,col="green")+theme_classic()
g=g+geom_errorbar(aes(x=label_num,ymin=low,ymax=up))
g=g+scale_x_continuous(breaks=GLS_data$label_num,label=GLS_data$label)
g=g+ylab("Estimate")+xlab("")
g
```

Based on the forest plot above, we see a strong positive time trend in the cohort's math scores, as expected. Children who have parents with a higher education perform significantly better in kindergarten but have significantly less improvement in their scores over time. Schools that are located in rural areas, towns, or suburban areas all have significantly higher math scores at baseline compared to urban schools, but we see no significant differences in math score improvement over time. 

\section{Discussion}



\section{Work Contributions}

Everyone: Report writing, Project planning \newline
Isabel: \newline
Dhajanae:  \newline
Nicholas: Data long format code, Gini Index bootstrap analysis, Cluster computing for GLS model \newline
Ritoban: \newline

\section{Github Repository}

The Github repository used in this project can be accessed at \url{https://github.com/igomez39/BIOS625}.

\section{References}




